(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Acox:function(e,t,o){"use strict";o.r(t);var n=o("pVnL"),i=o.n(n),s=o("gcR/"),a=o.n(s),r=o("lSNA"),l=o.n(r),d=(o("3bBZ"),o("q1tI")),c=o.n(d),h=o("ikHm"),u=o("y6Dp"),m=o("mF3+"),p=o("wpmu"),g=o("G4cA"),b=o("g4rC"),S=o("6WtK"),f=o("i3uR"),v=o("wldR"),y=o("LUuO"),k=o("wZk+"),C=o("stZG"),w=o("MvRd"),T=o("C7oc"),B=o("nM47"),P=o("FcJC"),I=o("6rsX"),M=o("TmDR"),A=o("uUOz"),x=o("Wae9"),R=o("MeYt"),O=o("7M94"),D=o("AXh+"),F=o("d9nj"),j=o("ETM2"),L=o("4aFz"),N=o("QcDD"),V=o("sdlW"),q=o("Sb6f"),E=o("G414"),U=o("Oy36"),W=o("OxuQ"),G=o("HSWF"),_=o("id5p"),z=o("zmp8"),Q=o("H4VD"),Z=o("/0g+"),H=o("MBf9"),X=o("h5Kq"),J=o("HRSx"),K=o("ov3o"),Y=o("58VE"),$=o("HTHG"),ee=o("UcZb"),te=o("Rtjx"),oe=o("JBsN"),ne=o("J9+s"),ie=o("Hq/H"),se=o("wS9/"),ae=o("qX+M"),re=o("bLTx"),le=o("gHFd");class de extends v.a{constructor(...e){super(...e),l()(this,"storeTypes",{shareButtonPopupStore:b.a}),l()(this,"handleOpenQuickFind",()=>{L.b({environment:this.environment,analyticsFrom:"public-page-topbar"})}),l()(this,"handleShareClick",()=>{u.pd(this.environment),B.e(this.environment)}),l()(this,"handleTopbarClick",()=>{I.e(this.environment)}),l()(this,"navigateToFirstSpace",()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=N.default.state;e&&t&&V.n({environment:this.environment,userRootStore:e,userSettingsStore:t})}),l()(this,"handleMoveToClick",e=>{E.d({blocks:[this.props.store],analyticsFrom:"quick_add",onAccept:this.handleMoveToAccept,isAddTo:!0})}),l()(this,"handleMoveToAccept",e=>{const{currentSpaceStore:t}=N.default.state;t&&this.props.saveParent&&G.A({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e}),u.Ec(this.environment)}),l()(this,"handleCancelQuickAdd",e=>{const t=N.default.state.currentBlockStore,o=K.a.state.lastPageId;t&&o&&(Q.navigateToBlock({environment:this.environment,store:p.a.createChildStore(t,{table:J.a,id:o}),showMoveTo:!1,saveParent:!1}),H.createAndCommit(this.environment,e=>{Z.b({environment:this.environment,blocks:[t],transaction:e})}))})}renderComponent(){const{store:e}=this.props,{WindowSizeStore:t,device:o}=this.environment,n=Object(D.g)(this.environment,this.props.store);return a()(C.a,{capture:!0,render:s=>c.a.createElement("div",i()({},s,{style:this.getWrapStyle()}),n?this.renderPublicPageTopbar():this.renderNormalTopbar(),e.canEdit()&&o.isPhone&&a()(M.a,{store:this.props.store,isMobile:!0},this.props.store.id),this.props.isOffline&&a()(X.b,{type:X.a.White,isMobile:!0},void 0,a()("div",{style:{display:"flex",alignItems:"center",width:"100%",paddingLeft:t.getSafePaddingLeftCSS(10),paddingRight:t.getSafePaddingRightCSS(14)}},void 0,m.a.mobileOffline({width:26,marginRight:12}),a()("div",{},void 0,a()(ne.FormattedMessage,{defaultMessage:"You're offline",id:"topbarMobile.offline.message"})))),a()(y.a,{banners:this.props.banners,isMobile:!0}))})}renderPublicPageTopbar(){const{store:e}=this.props;return a()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:O.Pb},void 0,this.environment.currentUser.isLoggedIn()&&a()(d.Fragment,{},void 0,a()(R.a,{style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:14,paddingRight:14,fontWeight:q.a.fontWeight.medium,color:this.theme.regularTextColor},mobileFeedback:!0,onClick:this.navigateToFirstSpace},void 0,a()(ne.FormattedMessage,{defaultMessage:"Back",id:"topbarMobile.backButton.label"})),a()("div",{style:{height:18,width:1,flexShrink:0,marginRight:6,background:this.theme.darkDividerColor}})),a()(S.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:1,showCurrentPageControls:!1,ancestorMaxWidth:100,currentPageMaxWidth:220,isMobile:!0}),a()("div",{style:{flexGrow:1,flexShrink:1}}),a()(F.a,{onClick:this.handleOpenQuickFind},void 0,m.a.searchThick({width:20,height:20})),a()(j.a,{store:e,buttonPopupStore:A.a}))}renderNormalTopbar(){const{store:e,pageVisitStore:t,presenceStore:o}=this.props,{isTablet:n}=this.environment.device,i=this.props.isInvalidPage;return a()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:O.Pb},void 0,this.renderHamburgerButton(),n&&a()(ie.a,{}),!i&&this.renderBreadcrumbs(),e.canEdit()&&n&&a()(M.a,{store:e,isMobile:!1},e.id),a()(w.a,{}),e.isRestricted()&&a()(re.a,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}),n&&e.canEdit()&&t&&o&&a()(oe.a,{rootStore:e,pageVisitStore:t,presenceStore:o}),this.props.shouldShowMoveTo?this.renderCancelQuickAdd():this.renderRightButtons())}renderHamburgerButton(){const e=x.a.getUnreadMentionsCountForOtherSpaces();return a()(R.a,{mobileFeedback:!0,style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,height:"100%",width:36,marginLeft:4},onClick:()=>{Object(te.a)(this.environment)?P.setExpand({environment:this.environment,isExpanded:!ee.a.get()}):P.open(),u.jd(this.environment)}},void 0,m.a.hamburgerMenu({width:18,height:18}),a()(T.a,{color:T.a.Color.Red,count:e,style:{position:"absolute",top:9,right:1}}))}renderBreadcrumbs(){const{isTablet:e}=this.environment.device;return this.props.shouldShowMoveTo?this.renderMoveTo():a()(S.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:e?2:1,showCurrentPageControls:!1,ancestorMaxWidth:e?160:100,currentPageMaxWidth:e?240:220,isMobile:!0})}renderMoveTo(){const{store:e}=this.props,t=e.getParentStore(),{currentSpaceStore:o}=N.default.state,n=t instanceof g.a&&o&&t.id===o.id;if(t){if(n)return a()(R.a,{mobileFeedback:!0,style:de.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,a()(ne.FormattedMessage,{defaultMessage:"<mediumcolor>Add to</mediumcolor>{userAvatar}<mediumweight>Private pages</mediumweight>",id:"topbarMobile.addToPrivateSectionButton.label",values:{mediumcolor:(...e)=>a()("span",{style:{color:this.theme.mediumTextColor,marginRight:8}},void 0,e),mediumweight:(...e)=>a()("span",{style:{fontWeight:q.a.fontWeight.medium,marginLeft:4}},void 0,e),userAvatar:a()(Y.a,{size:22,avatarShouldShowShadow:!0,userValue:Object($.g)(this.environment)})}}),this.renderChevron());{const o=e instanceof g.a?Object(ae.getSpaceIcon)(this.environment,e):e.getIcon();return a()(R.a,{mobileFeedback:!0,style:de.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,a()("span",{style:{color:this.theme.mediumTextColor}},void 0,a()(ne.FormattedMessage,{defaultMessage:"Add to",id:"topbarMobile.addToPageOrWorkspaceSectionButton.label",description:"Displayed to the user in front of a page or space, like 'Add to Page', where 'Page' is an existing page."})," "),a()(U.a,{disabled:!0,icon:o,isEmptyPage:t.table===J.a&&t.isEmptyPage(),title:t instanceof g.a?Object(ae.getSpaceName)(this.environment,t):void 0,size:24,style:{marginLeft:8,marginRight:4}}),a()(W.a,{style:{fontWeight:q.a.fontWeight.semibold},store:t}),this.renderChevron())}}}renderChevron(){return m.a.chevronDown({marginLeft:4,width:10,fill:this.theme.lightTextColor})}renderRightButtons(){const{device:e}=this.environment;if(!this.props.isInvalidPage)return e.isReactNative?a()(d.Fragment,{},void 0,this.renderShare(),this.renderShowMore()):a()(d.Fragment,{},void 0,this.renderShowMore(),this.renderShare(),this.renderUpdatesButton())}renderCancelQuickAdd(){return a()(R.a,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:16,paddingRight:16,fontWeight:q.a.fontWeight.medium,color:z.h.blue},onClick:this.handleCancelQuickAdd},void 0,a()(ne.FormattedMessage,{defaultMessage:"Cancel",id:"topbarMobile.cancelQuickAddButton.label"}))}renderShowMore(){return a()(k.a,{store:this.props.store,collectionViewStore:this.props.collectionViewStore,buttonPopupStore:A.a})}renderShare(){const{device:e}=this.environment;return a()(f.a,{popupType:e.isMobile?f.a.PopupType.SlideUp:f.a.PopupType.Popup,style:{width:460},buttonPopupStore:this.stores.shareButtonPopupStore,onClick:this.handleShareClick,renderOrigin:t=>c.a.createElement(R.a,i()({mobileFeedback:!0,style:de.actionButtonStyle},t),e.isAndroid?m.a.androidShare({width:16,height:16}):m.a.iOSShare({width:26})),render:()=>a()(le.LazyBlockPermissionsSettings,{buttonPopupStore:this.stores.shareButtonPopupStore,store:this.props.store,onClose:()=>{this.stores.shareButtonPopupStore.setState({...this.stores.shareButtonPopupStore.state,open:!1})}})})}renderUpdatesButton(){return a()(_.a,{format:_.a.Format.TopbarMobile})}getWrapStyle(){return{width:"100%",maxWidth:"100vw",zIndex:h.v}}getStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"100vw",height:se.b,marginTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(0),paddingRight:this.props.shouldShowMoveTo?e.getSafePaddingRightCSS(0):e.getSafePaddingRightCSS(7),boxShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:this.theme.contentBackground,transition:"box-shadow 300ms",WebkitUserSelect:"none",cursor:"pointer"}}getBreadcrumbsStyle(){const{isTablet:e}=this.environment.device;return{flexGrow:0,marginLeft:2,overflow:"auto",WebkitOverflowScrolling:"touch",marginRight:e?16:8,height:"100%"}}}l()(de,"actionButtonStyle",{display:"flex",alignItems:"center",height:"100%",paddingLeft:6,paddingRight:6}),l()(de,"moveToButtonStyle",{display:"flex",alignItems:"center",paddingLeft:8,paddingRight:12,fontSize:q.a.fontSize.UIRegular.mobile,lineHeight:q.a.lineHeight.UIRegular.mobile,whiteSpace:"nowrap",minWidth:0}),t.default=de},HTFi:function(e,t,o){"use strict";var n=o("LqYT"),i=o("X3py"),s=o("5qTp");t.a=new n.a(()=>{const{phase:e}=i.b.state;return!!s.default.state.open||(e===i.a.hidden||e===i.a.willHide)})},OeJx:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("lSNA"),a=o.n(s),r=(o("3bBZ"),o("q1tI")),l=o.n(r),d=o("yNyh"),c=o("G4GV"),h=o("wldR"),u=o("mF3+"),m=o("6rsX"),p=o("unoy"),g=o("D8Ld"),b=o("stZG"),S=o("rGsA"),f=o("J9+s");class v extends h.a{constructor(...e){super(...e),a()(this,"storeTypes",{store:c.a}),a()(this,"handleFocused",()=>{m.e(this.environment),p.f(this.environment),this.stores.store.setState({...this.stores.store.state,focus:!0})}),a()(this,"handleBlurred",()=>{this.stores.store.setState({...this.stores.store.state,focus:!1})}),a()(this,"handleSearchQueryChange",e=>{this.props.onChange({searchQuery:e.target.value})})}renderComponent(){const{searchQuery:e,intl:t}=this.props,{focus:o}=this.stores.store.state;return i()(g.a,{capture:o},void 0,i()(b.a,{capture:!0,render:n=>l.a.createElement("div",n,i()(d.b,{style:this.getStyle(),format:d.a.Transparent,value:e,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onFocus:this.handleFocused,onBlur:this.handleBlurred,showClearButton:!0,left:u.a.searchThick(this.getSearchIconStyle())}),i()(S.a,{show:o}))}))}getStyle(){return{boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,flexGrow:0,flexShrink:0,height:32,paddingLeft:8,paddingRight:12,borderRadius:3,fontSize:14,marginBottom:4}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}t.default=Object(f.injectIntl)(v)},QvPY:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("lSNA"),a=o.n(s),r=(o("3bBZ"),o("q1tI")),l=o.n(r),d=o("wldR"),c=o("QtqF"),h=o("4aFz"),u=o("8fuX"),m=o("UJva"),p=o("OIKt"),g=o("b936"),b=o("zK7c"),S=o("X6Ne"),f=o("pVnL"),v=o.n(f),y=o("i3uR"),k=o("5XPD"),C=o("Na01"),w=o("mF3+"),T=o("gbGO"),B=o("ohKz"),P=o("MeYt"),I=o("ty0h"),M=o("ibYI"),A=o("vJXr"),x=o("2A6Q"),R=o("pqiZ"),O=o("aEEb"),D=o("VoJ/"),F=o("CSYU"),j=o("wlCD"),L=o("QcDD"),N=o("qKs6"),V=o("J9+s"),q=o("r8MX"),E=o("Cycz"),U=o("2ZkR"),W=o("8Gp+"),G=o("rQb/"),_=o("IoOo");class z extends d.a{constructor(...e){super(...e),a()(this,"storeTypes",{passwordRequestStore:F.a}),a()(this,"handleClose",()=>{B.a.setState({open:!1})}),a()(this,"handleStartOfWeekToggle",()=>{1===this.getStartDayOfWeek()?Object(N.e)(this.environment):Object(N.d)(this.environment)})}renderComponent(){const{device:e}=this.environment,{data:t}=q.default.state,o=B.a.state.open,n="on"===U.default.getGroup(this.environment,"user-data-consent"),s=e.isIOS&&E.y(t);return i()(y.a,{popupType:e.isMobile?y.a.PopupType.SlideUp:y.a.PopupType.Popup,buttonPopupStore:B.a,renderOrigin:e=>l.a.createElement(P.a,v()({mobileFeedback:this.props.isMobile},e),i()(C.a,{left:this.renderIcon(),style:{background:o?this.theme.buttonHoveredBackground:"none"},isMobile:this.props.isMobile,disableMobileBorder:!0},void 0,i()(V.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.label"}))),render:()=>{let o;if(o=e.isMobile?{menuType:T.b.MenuType.Modal,title:i()(V.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.title"}),right:i()(V.FormattedMessage,{defaultMessage:"Done",id:"notificationSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,whiteBackground:!0}:{menuType:T.b.MenuType.Popup},A.a.state.online){const{passwordRequestStore:e}=this.stores;return l.a.createElement(T.b,o,e.state.loading?i()(j.a,{style:{margin:"50% auto"}}):i()(x.a,{},void 0,i()(k.a,{}),i()(R.a,{size:48,isHidden:!0}),i()(G.a,{divider:"full"},void 0,i()(V.FormattedMessage,{id:"notificationSettingsButton.generalSection.title",defaultMessage:"General"})),i()(D.a,{requestStore:e,isEducationPlan:E.x(t)}),this.renderAppearanceSettings(),s&&this.renderSubscriptionSettings(),n&&this.renderUserDataConsentSettings(),i()(R.a,{size:32}),i()(M.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:this.getStartDayOfWeek()||0})))}return i()(x.a,{},void 0,i()(O.a,{isSmall:!0,style:{textAlign:"center"}},void 0,i()(V.FormattedMessage,{defaultMessage:"Please go online to manage settings.",id:"notificationSettingsButton.goOnline.prompt"})))}})}renderUserDataConsentSettings(){return i()(l.a.Fragment,{},void 0,i()(R.a,{size:32}),i()(W.a,{}))}renderAppearanceSettings(){return i()(l.a.Fragment,{},void 0,i()(R.a,{size:32}),i()(I.a,{}))}renderSubscriptionSettings(){return i()(l.a.Fragment,{},void 0,i()(R.a,{size:32}),i()(_.a,{}))}renderIcon(){return w.a.sidebarSettings({fill:this.theme.mediumIconColor,width:16})}getStartDayOfWeek(){const{currentUserSettingsStore:e}=L.default.state;if(e){const t=e.getSettings();if(t)return t.start_day_of_week}}}var Q=z,Z=o("5ma9"),H=o("y6Dp");class X extends d.a{renderComponent(){const e=i()(V.FormattedMessage,{defaultMessage:"Upgrade to Pro",id:"upgradeMobileButton.upgradeButton.label"});return i()(P.a,{mobileFeedback:!0,onClick:this.showUpgradeModal(this.environment)},void 0,i()(C.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,e))}renderIcon(){return w.a.settingsUpgradeFilled({fill:this.theme.mediumIconColor,width:16})}showUpgradeModal(e){return()=>{Object(H.K)(e,{from:"mobile_sidebar",for_subscription_tier:"personal"});const{reactNative:t}=e;t&&t.openUpgradeModal(Object(Z.a)())}}}var J=X,K=o("g4rC"),Y=o("3wHm");class $ extends d.a{constructor(...e){super(...e),a()(this,"storeTypes",{buttonPopupStore:K.a}),a()(this,"handleClose",()=>{this.stores.buttonPopupStore.setState({open:!1})})}renderComponent(){if(!E.O(this.environment))return;const{store:e}=this.props,{buttonPopupStore:t}=this.stores;return i()(y.a,{buttonPopupStore:t,popupType:y.a.PopupType.SlideUp,renderOrigin:e=>l.a.createElement(P.a,v()({mobileFeedback:!0},e),i()(C.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,i()(V.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileSidebar.label"}))),render:()=>{if(A.a.state.online){const t={menuType:T.b.MenuType.Modal,title:i()(V.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileMemberSettings.title"}),right:i()(V.FormattedMessage,{defaultMessage:"Done",id:"memberSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose};return l.a.createElement(T.b,t,i()(Y.a,{store:e,isMobile:!0}))}this.renderOffline()}})}renderIcon(){return w.a.teamSize({fill:this.theme.mediumIconColor,width:16})}renderOffline(){return i()(x.a,{},void 0,i()(O.a,{isSmall:!0,style:{textAlign:"center"}},void 0,i()(V.FormattedMessage,{defaultMessage:"Please go online to manage members.",id:"memberSettingsButton.goOnline.prompt"})))}}var ee=$,te=o("FcJC"),oe=o("VyA+"),ne=o("yjqD"),ie=o("6rsX"),se=o("UcZb"),ae=o("0zNc"),re=o("84+D"),le=o("7M94"),de=o("Rtjx");class ce extends d.a{constructor(...e){super(...e),a()(this,"handleTouchStart",e=>{const t={x:e.touches[0].clientX,y:e.touches[0].clientY};se.c.state?t.x>Object(de.c)(this.environment)?re.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset():Object(de.h)(this.environment)&&t.x<100?re.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset()}),a()(this,"handleTouchMove",e=>{if(ae.a.state.isDragging)return void this.handleReset();const t=re.a.state;if(!t.touching)return;const o={x:e.touches[0].clientX,y:e.touches[0].clientY};if(t.swiping)re.a.setState({touching:!0,swiping:!0,start:t.start,speed:se.c.state?t.end.x-o.x:o.x-t.end.x,end:o});else{if(Math.abs(o.y-t.start.y)>=25)return void this.handleReset();(!se.c.state&&o.x-t.start.x>25||se.c.state&&t.start.x-o.x>25)&&re.a.setState({touching:!0,swiping:!0,start:t.start,speed:0,end:o})}this.updateTransform()}),a()(this,"handleTouchEnd",async()=>{const{ThemeStore:e}=this.environment,t=re.a.state;if(!t.swiping)return;const o=Object(de.c)(this.environment),n=document.querySelector(Object(de.h)(this.environment)?".".concat(le.Bb):".".concat(le.C)),i=document.querySelector(".".concat(le.C)),s=Math.abs(t.speed)>=8,a=s?"ease-out":"ease-in-out",r="dark"===e.state.mode?", 1px 0 0 ".concat(this.theme.shadowColor.alpha(2*this.theme.shadowOpacity).css()):"",l="\n\t\t\t".concat(this.theme.mediumBoxShadow,"\n\t\t\t").concat(r,"\n\t\t");if(se.c.state){const e=t.start.x-t.end.x;if(e+25*t.speed>o/2){let t=s?(o-e)/o*200:200;t=Math.max(t,1),n.style.transition="transform ".concat(t,"ms ").concat(a),n.style.transform="translateZ(0)translateX(0px)",Object(de.h)(this.environment)&&(n.style.boxShadow=l,i.style.transition="filter ".concat(t,"ms ").concat(a),i.style.filter="brightness(1)"),await ue(n),te.close(),this.handleReset()}else n.style.transition="transform ".concat(200,"ms ").concat(a),n.style.transform="translateZ(0)translateX(".concat(o,"px)"),Object(de.h)(this.environment)&&(n.style.boxShadow=l,i.style.transition="filter ".concat(200,"ms ").concat(a),i.style.filter="brightness(0.7)"),await ue(n),this.handleReset()}else{const e=t.end.x-t.start.x;if(e+25*t.speed>o/2){let t=s?(o-e)/o*200:200;t=Math.max(t,1),n.style.transition="transform ".concat(t,"ms ").concat(a),n.style.transform="translateZ(0)translateX(".concat(o,"px)"),Object(de.h)(this.environment)&&(n.style.boxShadow=l,i.style.transition="filter ".concat(t,"ms ").concat(a),i.style.filter="brightness(0.7)"),await ue(n),te.open(),this.handleReset()}else n.style.transition="transform ".concat(200,"ms ").concat(a),n.style.transform="translateZ(0)translateX(0px)",Object(de.h)(this.environment)&&(n.style.boxShadow=l,i.style.transition="filter ".concat(200,"ms ").concat(a),i.style.filter="brightness(1)"),await ue(n),this.handleReset()}}),a()(this,"handleSidebarToggle",()=>{this.updateTransform()}),a()(this,"updateTransform",()=>{const e=document.querySelector(Object(de.h)(this.environment)?".".concat(le.Bb):".".concat(le.C)),t=document.querySelector(".".concat(le.C)),o=Object(de.c)(this.environment),n=re.a.state;if(n.swiping)if(se.c.state){const i=o-(n.start.x-n.end.x)+25,s=Math.min(Math.max(0,i),o);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),Object(de.h)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const n=(1-.3*s/o).toString();t.style.filter="brightness(".concat(n,")")}}else{const i=n.end.x-n.start.x-25,s=Math.min(Math.max(0,i),o);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),Object(de.h)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const n=(1-.3*s/o).toString();t.style.filter="brightness(".concat(n,")")}}else se.c.state?(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(".concat(o,"px)"),Object(de.h)(this.environment)&&(e.style.transform="translateZ(0)translateX(calc(".concat(o,"px - 1px))"),e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="filter 200ms",t.style.filter="brightness(0.7)"),ie.e(this.environment)):(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(0)",Object(de.h)(this.environment)&&(e.style.boxShadow="none",t.style.transition="filter 200ms",t.style.filter="brightness(1)"))})}didMount(){const{device:e}=this.environment;e.isMobile&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),se.c.addListener(this.handleSidebarToggle))}willUnmount(){const{device:e}=this.environment;e.isMobile&&(window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),se.c.removeListener(this.handleSidebarToggle))}handleReset(){re.a.reset(),this.updateTransform()}}var he=ce;async function ue(e){const t=ne.c();e.addEventListener("transitionend",t.resolve),e.addEventListener("webkitTransitionEnd",t.resolve),await t.promise,e.removeEventListener("transitionend",t.resolve),e.removeEventListener("webkitTransitionEnd",t.resolve)}var me=o("GRWW"),pe=o("p0Uu"),ge=o("zmp8"),be=o("HTHG"),Se=o("NOLh"),fe=o("wS9/"),ve=o("ij+4"),ye=o("AUNf"),ke=o("jzfh"),Ce=o("1G+a"),we=o("A9TN"),Te=o("sdlW");class Be extends d.a{constructor(...e){super(...e),a()(this,"sidebarState",this.createComputedStore(()=>Object(be.i)(this.environment))),a()(this,"storeTypes",{scrollerStore:me.a}),a()(this,"handleScrollerMount",e=>{pe.a.SidebarMobileScroller=e}),a()(this,"handleCloseSidebar",()=>{te.close()}),a()(this,"handleClickFind",()=>h.c({environment:this.environment,analyticsFrom:"sidebar-mobile"})),a()(this,"handleOrientationChange",()=>{te.close()}),a()(this,"isScrolledToTop",this.createComputedStore(()=>0===this.stores.scrollerStore.state.scrollTop)),a()(this,"currentOfflinePages",this.createComputedStore(()=>ye.default.getCurrentOfflinePagesStore())),a()(this,"isCurrentIAPSubscriber",()=>{const{currentUserRootStore:e}=L.default.state,t=Object(E.b)({environment:this.environment,userRootStore:e});return!(!t||!t.includes(we.default.revenueCat.productIDs.personal.monthly)&&!t.includes(we.default.revenueCat.productIDs.personal.yearly))})}willMount(){window.addEventListener("resize",this.handleOrientationChange)}willUnmount(){window.removeEventListener("resize",this.handleOrientationChange)}renderComponent(){const e=de.a(this.environment);return e?i()(Se.a,{render:()=>i()("div",{className:le.Bb,style:this.getWrapStyle()},void 0,!e&&i()(he,{}),this.renderSidebar()),isVisible:!0,animationStyle:{width:e?de.b(this.environment):"100vw"}}):i()("div",{className:le.Bb,style:{...this.getWrapStyle(),width:"100vw"}},void 0,!e&&i()(he,{}),this.renderSidebar())}renderSidebar(){return i()(oe.a,{capture:!de.a(this.environment)&&se.c.get(),onBackButton:this.handleCloseSidebar},void 0,i()("div",{style:this.getStyle()},void 0,this.renderTopbar(),this.renderOutliner()))}renderTopbar(){const{device:e}=this.environment,t=e.isReactNative&&e.isTablet&&de.a(this.environment);return i()("div",{style:this.getTopbarStyle()},void 0,i()(ve.c,{shouldShowUnexpandButton:t,format:ve.a.Mobile,onSpaceClick:async({event:e,spaceViewStore:t})=>{await Te.o({environment:this.environment,spaceViewStore:t,userSettingsStore:L.default.state.currentUserSettingsStore,userRootStore:L.default.state.currentUserRootStore,metaClick:e.ctrlKey||e.metaKey})}}),!e.isReactNative&&i()(P.a,{onClick:this.handleClickFind,mobileFeedback:!0,style:Be.actionButtonStyle},void 0,w.a.mobileBottomBarSearch({width:26})))}renderOutliner(){const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:o,currentUserStore:n,currentUserSettingsStore:s,currentBlockStore:a}=L.default.state,r=this.sidebarState.state;if(!(r&&a&&t&&o&&e&&n&&s))return;const d=e.canEdit(),h=Object(Ce.b)({environment:this.environment})&&"personal_free"===Object(E.h)(this.environment)&&q.default.state.data&&"unsubscribed_admin"===q.default.state.data.type&&q.default.state.data.revenueCatEnabled&&!this.isCurrentIAPSubscriber();return i()(b.a,{store:e,disableEditNearestBlock:!0,render:o=>l.a.createElement(u.b,{store:this.stores.scrollerStore,ref:this.handleScrollerMount,style:Be.outlinerStyle,disableScroll:S.e(this.environment),type:u.a.Y},r.showOfflineSection&&i()(p.a,{isMobile:!0,type:"offline",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i()(c.a,{isMobile:!0,type:"offline",isTopLevel:!0,spaceStore:e,spaceViewStore:t,childStores:this.currentOfflinePages.state,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!d})}),r.showBookmarksSection&&i()(p.a,{isMobile:!0,type:"bookmarks",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i()(c.a,{isMobile:!0,type:"bookmarks",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getBookmarkedPagesStore(),childStores:t.getBookmarkedPages(),showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!d})}),r.showWorkspaceSection&&i()(p.a,{isMobile:!0,type:"workspace",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i()(c.a,{isMobile:!0,type:"workspace",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getWorkspacePages(),addPageTitle:i()(V.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addPageToWorkspace.title"}),onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,showAddPageButton:!0,disabled:!d})}),r.showSharedSection&&i()(p.a,{isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:o=>l.a.createElement(l.a.Fragment,null,i()(c.a,{isMobile:!0,type:"shared",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getSharedPagesStore(),childStores:r.visibleSharedPagesStores,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!d}),this.isEnhancedSidebarEnabled&&r.showSharedOverflowButton&&i()(ke.a,{originRef:o,isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,userSettingsStore:s,allSharedPages:r.allSharedPagesStores,visiblePageIds:r.visibleSharedPagesStores.map(({id:e})=>e)}))}),r.showPrivateSection&&!r.showOnlyPrivateSection&&i()(p.a,{isMobile:!0,type:"private",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i()(c.a,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(),addPageTitle:i()(V.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPrivatePage.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!d})}),r.showOnlyPrivateSection&&i()(c.a,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(),addPageTitle:i()(V.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPageToOnlyPrivateSection.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!d}),r.showOnlyPrivateSection&&i()("div",{style:{height:20}}),i()(ee,{store:e}),i()(Q,{isMobile:!0}),e.canEdit()&&i()(g.a,{store:a,isMobile:!0}),h&&i()(J,{}),i()(m.a,{isMobile:!0}),i()("div",{style:{height:128}}))})}get isEnhancedSidebarEnabled(){return"on"===U.default.getGroup(this.environment,"sidebar-enhancements")}getWrapStyle(){return de.a(this.environment)?{display:"block",height:"100vh",position:"relative",zIndex:3}:de.h(this.environment)?{display:"block",height:"100vh",position:"fixed",top:0,right:"100%",zIndex:3}:{display:"block",height:"100vh",position:"fixed",top:0,left:0}}getStyle(){return{display:"flex",flexDirection:"column",width:de.c(this.environment),height:"100%",background:de.h(this.environment)?this.theme.mobileSidebarAndroidBackground:this.theme.mobileSidebarIOSBackground,willChange:"transform",color:this.theme.mediumTextColor,...de.h(this.environment)&&{marginLeft:"auto"},...de.a(this.environment)&&{position:"absolute",right:0},cursor:"pointer"}}getTopbarStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"none",height:fe.b,marginTop:e.state.paddingTopCSS,paddingLeft:12,boxShadow:de.h(this.environment)&&!de.a(this.environment)&&se.c.state?this.isScrolledToTop.state?this.theme.topbarAndroidShadowCollapsed:this.theme.topbarAndroidShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:de.h(this.environment)?this.theme.androidSidebarBackground:ge.h.transparent,transition:"box-shadow 300ms",width:"100%",zIndex:1}}}a()(Be,"outlinerStyle",{flexGrow:1,paddingTop:12,userSelect:"none",WebkitUserSelect:"none"}),a()(Be,"actionButtonStyle",{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",height:"100%",width:44,paddingRight:6});t.default=Be},W8UH:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("lSNA"),a=o.n(s),r=(o("3bBZ"),o("LvDl")),l=o.n(r),d=o("q1tI"),c=o("mKX5"),h=o("wldR"),u=o("mF3+"),m=o("LEzx");class p extends m.a{getInitialState(){return{}}}var g=p,b=o("Sb6f"),S=o("/YYm"),f=o("Oy36"),v=o("OxuQ"),y=o("IdIf"),k=o("0lqH"),C=o("D2XV"),w=o("7TLZ"),T=o("prF1"),B=o("SR/M"),P=o("vl8/");class I extends h.a{constructor(...e){super(...e),a()(this,"renderProperty",e=>{const{schema:t,store:o,blockPropertyValueOverlayStore:n}=this.props;if(t[e])return i()(k.b,{store:o,property:e,schema:t,disabled:!0,locked:!1,format:k.b.Format.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n},e)})}renderComponent(){const{time:e,store:t}=this.props,o=t.hasIcon()||!t.isEmptyPage(),n=Object(S.a)({store:t,fullyQualified:!1}),s=w.h(t);return i()(T.a,{href:n},void 0,i()(B.a,{focused:!1,title:i()(d.Fragment,{},void 0,e&&i()("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6}},void 0,e),i()("div",{style:{display:"flex",alignItems:"center",...e&&{marginBottom:8}}},void 0,o&&i()(f.a,{disabled:!0,icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),size:24,style:{flexShrink:0,marginRight:8}}),i()(v.a,{store:t,style:{fontWeight:b.a.fontWeight.semibold}}),s>0&&i()("div",{style:{display:"flex",alignItems:"center",color:this.theme.regularDividerColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,u.a.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),s))),caption:this.renderProperties()}))}renderProperties(){const{format:e,schema:t,store:o}=this.props,n=(e.calendar_properties?e.calendar_properties.filter(e=>e.visible).map(e=>e.property):[]).filter(e=>y.e({blockValue:o.getValue(),property:e,schema:t,getRecordValue:o.getRecordValue,userTimeZone:C.m,intl:P.default.getIntl()}));if(n.length>0)return i()("div",{style:{marginTop:8}},void 0,n.map(this.renderProperty))}}var M=I,A=o("wpmu"),x=o("1QGs"),R=o("MBf9"),O=o("gbGO"),D=o("2Y+N"),F=o("nObc"),j=o("VVDu"),L=o("zTdN"),N=o("lCCU"),V=o("H4VD"),q=o("O+wX"),E=o("zgcg"),U=o("J9+s"),W=o("nPEg"),G=o("L/re"),_=o("RSEC"),z=o("hU3F"),Q=o("HRSx");class Z extends h.a{constructor(...e){super(...e),a()(this,"storeTypes",{store:g,resultStore:z.a.of(void 0)}),a()(this,"renderResults",()=>{const{disabled:e,collectionStore:t}=this.props,o=this.getCurrentStartOfDay(),n=o.clone().endOf("day"),s=this.getCurrentResults();return i()(O.b,{menuType:O.b.MenuType.Modal,title:i()("div",{style:Z.headerStyle},void 0,i()(N.a,{onClick:this.handleLeftClick,icon:u.a.chevronLeft,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),i()("div",{},void 0,o.format("MMMM Do")),i()(N.a,{onClick:this.handleRightClick,icon:u.a.chevronRight,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})),right:i()(W.DoneMenuText,{}),onClickRight:this.props.onDismiss},void 0,!s&&i()(D.a,{},void 0,i()(j.a,{})),s&&0===s.length&&i()(D.a,{},void 0,i()(L.a,{title:i()(U.FormattedMessage,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})),s&&s.length>0&&i()(D.a,{},void 0,s.map(e=>{const i=A.a.createChildStore(t,{id:e.id,table:Q.a});return this.renderItem(i,e,o,n)})),!e&&i()(D.a,{topBorder:!0},void 0,i()(F.a,{focused:!1,onClick:this.handleAddItemClick,title:i()(U.FormattedMessage,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})})))}),a()(this,"handleLeftClick",()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(-1,"day").valueOf()})}),a()(this,"handleRightClick",()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(1,"day").valueOf()})}),a()(this,"handleAddItemClick",()=>{const{collectionViewLocalStore:e,collectionStore:t,calendarBy:o,resultsStore:n}=this.props,i=this.getCurrentStartOfDay(),s=R.createAndCommit(this.environment,s=>x.e({environment:this.environment,collectionStore:t,collectionViewLocalStore:e,calendarBy:o,startOfDay:i.valueOf(),results:n.state,transaction:s})),a=Object(S.a)({store:s});this.navigate(a)}),a()(this,"reducerStore",this.createComputedStore(()=>{const{collectionViewLocalStore:e}=this.props;return Object(G.b)({collectionViewLocalStore:e,startOfDay:this.getCurrentStartOfDay().valueOf()})},!0)),a()(this,"getRecordValue",this.props.collectionStore.getRecordValue)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):V.navigate({environment:this.environment,url:e})}renderComponent(){const{collectionViewLocalStore:e}=this.props,t=this.reducerStore.state;if(t)return i()(_.a,{id:"calendar_day_results",reducer:t,collectionViewLocalStore:e,render:this.renderResults,resultStore:this.stores.resultStore})}renderItem(e,t,o,n){const{disabled:s,blockPropertyValueOverlayStore:a}=this.props;return i()(M,{store:e,time:t.includeTime?this.renderTime(t,o,n):void 0,disabled:s,format:this.props.format,schema:this.props.schema,blockPropertyValueOverlayStore:a},t.id)}renderTime(e,t,o){const{schema:n,calendarBy:i,intl:s}=this.props,a=n[i];if(!a||"date"!==a.type)return;const r=a.date_format||C.v,l=a.time_format||C.x,d=Object(c.a)(e.start),h=e.end?Object(c.a)(e.end):void 0,u=Boolean(!d.isBetween(t,o)||h&&!h.isBetween(t,o));if(e.end){const t=C.s(e.start.valueOf(),e.end?e.end.valueOf():e.start.valueOf(),e.timeZone);return u?Object(q.a)({value:t,date_format:r,time_format:l,userTimeZone:e.timeZone,allowRelativeDates:!0,intl:s}):Object(q.d)({start_time:t.start_time,end_time:t.end_time,time_format:l,humanReadable:!0,intl:s})}return Object(q.c)({start_time:C.r(e.start.valueOf(),e.timeZone).start_time,time_format:l,humanReadable:!0,intl:s})}getCurrentStartOfDay(){const{currentStartOfDay:e}=this.stores.store.state;return e?Object(c.a)(e):Object(c.a)(this.props.initialStartOfDay)}getCurrentResults(){const{collectionStore:e,collectionViewLocalStore:t}=this.props,o=this.stores.resultStore.state,n=t.normalizedQueryStore.state,i=t.normalizedSchemaStore.state,s=n?n.calendar_by:void 0;if(!(o&&n&&s&&i))return;let a=l.a.compact(o.blockIds.map(t=>{const o=A.a.createChildStore(e,{id:t,table:Q.a});return Object(G.a)({blockStore:o,calendarBy:s,schema:i,getRecordValue:this.getRecordValue,intl:this.props.intl})}));return n.sort||(a=l.a.sortBy(a,e=>e.start)),a}}a()(Z,"contextTypes",E.a),a()(Z,"headerStyle",{display:"flex",alignItems:"center",height:"100%"});t.default=Object(U.injectIntl)(Z)},ZKzj:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("pVnL"),a=o.n(s),r=o("lSNA"),l=o.n(r),d=(o("3bBZ"),o("q1tI")),c=o.n(d),h=o("LvDl"),u=o.n(h),m=o("mF3+"),p=o("gRnv"),g=o("l4I2"),b=o("CaJT"),S=o("q2qQ"),f=o("6rsX"),v=o("y6Dp"),y=o("Sb6f"),k=o("BJyN"),C=o("sFjn"),w=o("VOS9"),T=o("gbGO"),B=o("wldR"),P=o("9hmv"),I=o("q8I6"),M=o("y4kc"),A=o("2HDO"),x=o("F9et"),R=o("oaNT"),O=o("MBf9"),D=o("unoy"),F=o("ikHm"),j=o("hi+p"),L=o("wXH4"),N=o("RI9y"),V=o("ALSZ"),q=o("Ajfl"),E=o("sjR4"),U=o("DNgp"),W=o("Iece"),G=o("MeYt"),_=o("typy"),z=o("6nbh"),Q=o("wiBh"),Z=o("wllP"),H=o("J9+s"),X=o("QcDD"),J=o("RQ1t"),K=o("WgIs"),Y=o("rro+"),$=o("ui+/"),ee=o("bVDK"),te=o("30UQ"),oe=o("nM47"),ne=o("2Y+N"),ie=o("nPEg"),se=o("xPzf"),ae=o("VpIZ"),re=o("HTFi"),le=o("tCjx"),de=o("1G+a"),ce=o("3Z0Q");class he extends B.a{constructor(...e){super(...e),l()(this,"storeTypes",{store:C.a,ignoreSelectionAreaStore:z.a,templatePickerMenuListStore:J.a}),l()(this,"scrollerDiv",void 0),l()(this,"currentlyShownTimer",void 0),l()(this,"renderMobileTemplatePreviewItem",e=>({key:e.name,render:t=>c.a.createElement(ee.a,a()({},t,{key:e.name,title:e.name,type:"page_template",format:"phone-modal",emoji:e.emoji,locked:!1})),action:()=>{te.i({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}})),l()(this,"renderPageTemplatePickerItem",e=>{const t=this.props.currentBlockStore;return{key:e.name,render:t=>c.a.createElement(ee.a,a()({},t,{key:e.name,format:"phone-modal",title:e.name,type:e.type,icon:e.icon,locked:!1})),action:o=>{t&&Object(oe.j)(this.environment)&&(v.te(this.environment,{name:e.name,is_keyboard:"keydown"===o.event.type}),e.onClick(this.environment,t))}}}),l()(this,"handleScrollerRef",e=>{e&&(this.scrollerDiv=e)}),l()(this,"handleCloseColorPopup",()=>{this.stores.store.setState({...this.stores.store.state,isColorOpen:!1})}),l()(this,"handleCloseInsertPopup",()=>{this.stores.store.setState({...this.stores.store.state,isInsertOpen:!1})}),l()(this,"handleCloseTurnIntoPopup",()=>{this.stores.store.setState({...this.stores.store.state,isTurnIntoOpen:!1})}),l()(this,"handleCloseTemplatesPopup",()=>{this.stores.store.setState({...this.stores.store.state,isTemplatesOpen:!1})}),l()(this,"handleUnindent",e=>{if("editing"!==U.default.state.mode)return;const t=U.default.state.store,o=Object(Z.c)(t);o&&(O.createAndCommit(this.environment,e=>{q.t({environment:this.environment,store:t,closestSelectable:o,shiftKey:!0,transaction:e})}),this.trackItemTap("unindent"))}),l()(this,"handleIndent",e=>{if("editing"!==U.default.state.mode)return;const t=U.default.state.store,o=Object(Z.c)(t);o&&(O.createAndCommit(this.environment,e=>{q.t({environment:this.environment,store:t,closestSelectable:o,shiftKey:!1,transaction:e})}),this.trackItemTap("indent"))}),l()(this,"handleMoveUp",e=>{if("editing"!==U.default.state.mode)return;const t=U.default.state.store,o=Object(Z.c)(t);o&&(O.createAndCommit(this.environment,e=>{q.q({environment:this.environment,store:t,closestSelectable:o,transaction:e})}),this.trackItemTap("move-up"))}),l()(this,"handleMoveDown",e=>{if("editing"!==U.default.state.mode)return;const t=U.default.state.store,o=Object(Z.c)(t);o&&(O.createAndCommit(this.environment,e=>{q.p({environment:this.environment,store:t,closestSelectable:o,transaction:e})}),this.trackItemTap("move-down"))}),l()(this,"handleUndo",()=>{b.f(this.environment),this.trackItemTap("undo")}),l()(this,"handleRedo",()=>{b.e(this.environment),this.trackItemTap("redo")}),l()(this,"handleDismissKeyboard",e=>{f.e(this.environment),this.handleCloseInsertPopup(),this.trackItemTap("hide_keyboard"),D.e()}),l()(this,"handleInsert",e=>{this.stores.store.setState({...this.stores.store.state,isInsertOpen:!0}),this.trackItemTap("insert")}),l()(this,"handleTakePicture",e=>{R.a(this.environment),this.trackItemTap("take_picture")}),l()(this,"handleMention",e=>{V.e(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0}),this.trackItemTap("mention")}),l()(this,"handleComment",e=>{const t=E.default.state.stores[0];t&&(p.d({environment:this.environment,blockStore:t}),this.trackItemTap("discuss"))}),l()(this,"handleDelete",e=>{const t=E.default.state.stores[0],o=U.default.state;if(t&&"editing"===o.mode){const e=o.store,n=Object(Q.g)(e)||Object(Q.h)(e);if(O.createAndCommit(this.environment,e=>{S.n({store:t,transaction:e})}),n){const e=Object(Z.c)(n);f.f({environment:this.environment,store:e}),f.g(this.environment)}else f.e(this.environment);this.trackItemTap("remove")}}),l()(this,"handleActionsScroll",()=>{v.e(this.environment)}),l()(this,"handleActionsScrollDebounced",u.a.debounce(this.handleActionsScroll,500)),l()(this,"handleMoreClick",e=>{f.r({environment:this.environment,stores:E.default.state.stores}),j.c({environment:this.environment,stores:E.default.state.stores,actions:k.c,left:e.clientX,top:e.clientY,showInput:!1,analyticsFrom:"mobile_more_menu"})}),l()(this,"listenForPositionChanges",this.createComputedStore(()=>{const e=U.default.state;return"editing"===e.mode?{scrollTop:W.a.state.scrollTop,editing:!0,store:e.store.id,selection:e.selection.endIndex}:{scrollTop:W.a.state.scrollTop,editing:!1}})),l()(this,"shouldShow",this.createComputedStore(()=>ce.c(this.environment,this.stores.ignoreSelectionAreaStore))),l()(this,"shouldShowTextActions",this.createComputedStore(()=>ce.e(this.stores.ignoreSelectionAreaStore))),l()(this,"shouldShowBlockActions",this.createComputedStore(()=>!this.shouldShowTextActions.state)),l()(this,"canTriggerBlockActions",this.createComputedStore(()=>ce.a(this.shouldShowBlockActions.state,this.pageContext&&this.pageContext.publicEditModeStore.state))),l()(this,"canTriggerTextActions",this.createComputedStore(()=>ce.b(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore)))}willMountOrUpdate(){const{device:e}=this.environment;if(e.isMobileBrowser){const e=this.shouldShow.state,t=this.stores.store.state.isOpen;e?t?void 0!==this.currentlyShownTimer&&(window.clearTimeout(this.currentlyShownTimer),this.currentlyShownTimer=void 0):(this.stores.store.setState({...this.stores.store.state,isOpen:!0}),this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)):t&&void 0===this.currentlyShownTimer&&(this.currentlyShownTimer=window.setTimeout(()=>{this.currentlyShownTimer=void 0,this.stores.store.setState({...this.stores.store.state,isOpen:!1})},200))}else this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,o=this.isOpen();return i()(d.Fragment,{},void 0,i()(x.a,{capture:!0,render:e=>c.a.createElement("div",a()({},e,{style:{position:"relative",width:"100%",height:0,zIndex:F.j}}),this.renderActionBar(),this.renderInsertPopup(),this.renderTurnIntoPopup(),this.renderColorPopup(),this.renderTemplatesPopup())}),!o&&e.isIPhoneX&&e.isNative&&i()("div",{style:{position:"absolute",bottom:0,background:"transparent",height:t.state.paddingBottomCSS,width:"100%",pointerEvents:"none",WebkitUserSelect:"none"}}))}renderActionBar(){const{device:e,WindowSizeStore:t}=this.environment,o=this.isOpen(),n=e.isMobile&&re.a.state;if(this.props.position===de.a.Bottom)return i()("div",{style:{position:"absolute",bottom:n?t.getSafePaddingBottomCSS(le.default.height):0,left:0,height:he.height,width:"100%",pointerEvents:o?"auto":"none",opacity:o?1:0,transform:o?"translateY(0)":"translateY(".concat(he.height,"px)"),transition:"opacity 120ms ease-out, transform 120ms ease-out"}},void 0,this.renderActionButtons());{const e=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionRect||N.getSelectionRect();if(!e)return;const t=document.body.getBoundingClientRect(),n={...e,left:10,top:e.top+10-t.top};this.listenForPositionChanges.state;const{device:s}=this.environment;return i()(L.c,{popupType:s.isReactNative?L.c.PopupType.SlideUp:L.c.PopupType.Popup,open:o,preventBlockRenderQueueOnEnter:!0,placementToOrigin:L.c.Placement.Bottom,alignmentToOrigin:L.c.Alignment.Start,originRect:n,disableMouseCapture:!0,keepFocus:!0,render:()=>i()("div",{style:{height:he.height,width:"calc(80wv)",borderRadius:3,overflow:"hidden"}},void 0,this.renderActionButtons())})}}renderActionButtons(){const e=this.shouldShowTextActions.state,t=this.shouldShowBlockActions.state,o=this.shouldShowTemplatesButton();return i()("div",{style:this.getActionButtonStyles()},void 0,o&&this.renderTemplatesButton(),!o&&t&&this.renderBlockActions(),!o&&e&&this.renderTextActions(),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderLeft:this.getItemBorder(),borderRight:"none"},onClick:this.handleDismissKeyboard},void 0,he.keyboardIcon))}renderBlockActions(){const e=this.canTriggerBlockActions.state;let t=!1,o=!1;const n=this.props.currentBlockStore.getValue();n&&(Object(ae.B)(n)||(t=!0),Object(ae.C)(n)||(o=!0));const{device:s}=this.environment;return c.a.createElement("div",{ref:this.handleScrollerRef,style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),...!s.isSmallPhone&&{paddingLeft:12,paddingRight:12}},onClick:this.handleInsert,disabled:!e},void 0,he.plusIcon,this.renderChevronDown()),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:y.a.fontWeight.medium},onClick:e=>{this.stores.store.setState({...this.stores.store.state,isTurnIntoOpen:!0}),this.trackItemTap("turn_into")},disabled:!e},void 0,i()(H.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.buttonTitle"}),this.renderChevronDown()),i()(x.a,{capture:!0,render:e=>c.a.createElement(G.a,a()({mobileFeedback:!0,disabledFeedback:!0},e,{style:this.getItemStyle(),onClick:this.handleMention,disabled:!o}),i()("span",{style:{fontSize:19,lineHeight:1,fontWeight:y.a.fontWeight.medium,marginBottom:s.isAndroid?4:0}},void 0,"@"))}),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleComment,disabled:!t},void 0,he.discussionIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleTakePicture,disabled:!e},void 0,he.imageIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleDelete,disabled:!e},void 0,he.trashIcon),this.renderBlockMovementActions(),this.renderBlockUndoActions(),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:y.a.fontWeight.medium},onClick:e=>{this.stores.store.setState({...this.stores.store.state,isColorOpen:!0}),this.trackItemTap("color")},disabled:!e},void 0,i()(H.FormattedMessage,{defaultMessage:"Color",id:"mobileActionBar.color.buttonTitle"}),this.renderChevronDown()),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:y.a.fontWeight.medium},onClick:this.handleMoreClick,disabled:!e},void 0,i()(H.FormattedMessage,{defaultMessage:"More",id:"mobileActionBar.more.buttonTitle"}),this.renderChevronDown()))}renderBlockMovementActions(){const e=this.canTriggerBlockActions.state,t=E.default.state.stores[0];return i()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!e||!g.b(t),onClick:this.handleUnindent},void 0,he.unindentIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!e||!g.a(t),onClick:this.handleIndent},void 0,he.indentIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!e,onClick:this.handleMoveUp},void 0,he.moveUpIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!e,onClick:this.handleMoveDown},void 0,he.moveDownIcon))}renderBlockUndoActions(){return i()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!b.b(),onClick:this.handleUndo},void 0,he.undoIcon),i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:he.minorItemStyle,disabled:!b.a(),onClick:this.handleRedo},void 0,he.redoIcon))}renderTextActions(){const e=this.canTriggerTextActions.state,t=this.props.currentBlockStore.canComment();return i()("div",{style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},void 0,i()(M.a,{style:this.getItemStyle(),blockStore:E.default.state.stores[0],disabled:!t}),i()(P.a,{type:"b",style:this.getItemStyle(),onClick:()=>this.trackItemTap("bold"),disabled:!e},void 0,i()("span",{style:{fontWeight:y.a.fontWeight.semibold}},void 0,i()(H.FormattedMessage,{defaultMessage:"B",id:"mobileActionBar.bold.symbol",description:"Letter 'B' which represents 'bold' format option."}))),i()(P.a,{type:"i",style:this.getItemStyle(),onClick:()=>this.trackItemTap("italic"),disabled:!e},void 0,i()("span",{style:{fontStyle:"italic",fontWeight:y.a.fontWeight.semibold}},void 0,i()(H.FormattedMessage,{defaultMessage:"i",id:"mobileActionBar.italic.symbol",description:"Letter 'i' which represents 'italic' format option."}))),i()(P.a,{type:"_",style:this.getItemStyle(),onClick:()=>this.trackItemTap("underline"),disabled:!e},void 0,i()("span",{style:{textDecoration:"underline"}},void 0,i()(H.FormattedMessage,{defaultMessage:"U",id:"mobileActionBar.underline.symbol",description:"Letter 'U' which represents 'underline' format option."}))),i()(P.a,{type:"s",style:this.getItemStyle(),onClick:()=>this.trackItemTap("strike_through"),disabled:!e},void 0,i()("span",{style:{textDecoration:"line-through"}},void 0,i()(H.FormattedMessage,{defaultMessage:"S",id:"mobileActionBar.strikeThrough.symbol",description:"Letter 'S' which represents 'strike-through' format option."}))),i()(P.a,{type:"c",style:this.getItemStyle(),onClick:()=>this.trackItemTap("code"),disabled:!e},void 0,i()("span",{style:{fontFamily:y.a.fontFamily.githubMono}},void 0,i()(H.FormattedMessage,{defaultMessage:"Code",id:"mobileActionBar.code.symbol",description:"Word 'code' which represents 'code' format option."}))),i()(I.a,{style:this.getItemStyle(),disabled:!e},void 0,i()("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},void 0,i()(H.FormattedMessage,{defaultMessage:"Link",id:"mobileActionBar.link.symbol",description:"Word 'link' which represents 'link' format option."}))),i()(se.a,{onClick:()=>this.trackItemTap("equation"),disabled:!e,style:this.getItemStyle()},void 0,m.a.equation({width:16,height:16})),i()(_.a,{style:this.getItemStyle(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,disabled:!e}))}renderTemplatesButton(){return i()("div",{style:this.getActionMenuStyle()},void 0,i()(G.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderRight:"none",fontWeight:y.a.fontWeight.medium},onClick:e=>{this.stores.store.setState({...this.stores.store.state,isTemplatesOpen:!0}),this.trackItemTap("templates")}},void 0,m.a.templatesColor({width:20,marginRight:8}),i()(H.FormattedMessage,{defaultMessage:"Choose a template...",id:"mobileActionBar.templates.buttonTitle"}),this.renderChevronDown()))}renderInsertPopup(){const{device:e}=this.environment;return i()(A.a,{capture:this.stores.store.state.isInsertOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:t=>i()(L.c,{popupType:e.isMobile?L.c.PopupType.SlideUp:L.c.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,open:this.stores.store.state.isInsertOpen,keepFocus:!0,onDismiss:()=>{t(),this.handleCloseInsertPopup()},render:()=>i()(T.b,{menuType:T.b.MenuType.Modal,title:i()(H.FormattedMessage,{defaultMessage:"Insert block",id:"mobileActionBar.insertBlock.modalTitle"}),right:i()(ie.CancelMenuText,{}),onClickRight:()=>{t(),this.handleCloseInsertPopup()}},void 0,i()(w.a,{sections:k.h,context:{environment:this.environment,blocks:E.default.state.stores},onAccept:this.handleCloseInsertPopup}))})})}renderTurnIntoPopup(){const{device:e}=this.environment;return i()(A.a,{capture:this.stores.store.state.isTurnIntoOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>i()(L.c,{popupType:e.isMobile?L.c.PopupType.SlideUp:L.c.PopupType.Popup,open:this.stores.store.state.isTurnIntoOpen,keepFocus:!0,onDismiss:this.handleCloseTurnIntoPopup,preventBlockRenderQueueOnEnter:!0,render:()=>i()(T.b,{menuType:T.b.MenuType.Modal,title:i()(H.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.modalTitle"}),right:i()(ie.CancelMenuText,{}),onClickRight:this.handleCloseTurnIntoPopup},void 0,i()(w.a,{sections:[{...k.r,title:""}],context:{environment:this.environment,blocks:E.default.state.stores},onAccept:this.handleCloseTurnIntoPopup}))})})}renderColorPopup(){const{device:e}=this.environment;return i()(A.a,{capture:this.stores.store.state.isColorOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>i()(L.c,{popupType:e.isMobile?L.c.PopupType.SlideUp:L.c.PopupType.Popup,open:this.stores.store.state.isColorOpen,keepFocus:!0,onDismiss:this.handleCloseColorPopup,preventBlockRenderQueueOnEnter:!0,render:()=>i()(T.b,{menuType:T.b.MenuType.Modal,title:i()(H.FormattedMessage,{defaultMessage:"Block color",id:"mobileActionBar.blockColor.modalTitle"}),right:i()(ie.CancelMenuText,{}),onClickRight:this.handleCloseColorPopup},void 0,i()(w.a,{sections:[k.p,k.o,k.b],context:{environment:this.environment,blocks:E.default.state.stores},onAccept:this.handleCloseColorPopup}))})})}renderTemplatesPopup(){const{device:e}=this.environment;return i()(A.a,{capture:this.stores.store.state.isTemplatesOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:()=>i()(L.c,{popupType:e.isMobile?L.c.PopupType.SlideUp:L.c.PopupType.Popup,open:this.stores.store.state.isTemplatesOpen,keepFocus:!0,render:()=>i()(T.b,{menuType:T.b.MenuType.Modal,title:i()(H.FormattedMessage,{defaultMessage:"Templates",id:"mobileActionBar.templates.modalTitle"}),right:i()(ie.CancelMenuText,{}),onClickRight:this.handleCloseTemplatesPopup},void 0,i()(K.a,{type:K.a.Type.Vertical,store:this.stores.templatePickerMenuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onAccept:this.handleCloseTemplatesPopup,sections:[{key:"Basic",render:e=>i()(ne.a,{},void 0,e.children),items:Y.e.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>i()(ne.a,{title:i()(H.FormattedMessage,{defaultMessage:"Database",id:"mobileActionBar.databaseSection.title"})},void 0,e.children),items:Y.a.filter(e=>e.shouldShow(this.environment)).map(this.renderPageTemplatePickerItem)},...$.b(this.environment,this.props.intl).map(e=>({key:e.name,render:t=>i()(ne.a,{title:e.name},e.name,t.children),items:e.items.map(this.renderMobileTemplatePreviewItem)}))]}))})})}renderChevronDown(){return m.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.shouldShow.state}trackItemTap(e){v.Me(this.environment,{itemName:e})}shouldShowTemplatesButton(){const{isPhone:e}=this.environment.device,t=this.props.currentBlockStore,o=X.default.state.currentLoadingContainerStore,n=Boolean(t&&t.isCollectionView()),i=Boolean(t&&t.getParentCollectionStore()),s=this.environment.currentUser.isLoggedIn();return Boolean(!i&&!n&&e&&t&&o&&t.hasValue()&&t.canEdit()&&0===t.getContentIds().length&&s&&o.state.ready)}getItemBorder(){return"1px solid ".concat(this.theme.regularDividerColor)}getActionButtonStyles(){const{device:e,WindowSizeStore:t}=this.environment;return{height:"100%",width:"100%",fontSize:15,display:"flex",boxShadow:this.props.position===de.a.Bottom?this.theme.bottomActionBarShadow:this.theme.mediumBoxShadow,backgroundColor:this.theme.keyboardActionBarBackground,paddingLeft:e.isReactNative?t.state.paddingLeftCSS:0,paddingRight:e.isReactNative?t.state.paddingRightCSS:0}}getActionMenuStyle(){return{flexGrow:1,flexShrink:1,marginRight:-1,display:"flex",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch"}}getItemStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:e.isSmallPhone?8:10,paddingRight:e.isSmallPhone?8:10,borderRight:this.getItemBorder(),whiteSpace:"nowrap",height:he.height,flexShrink:0,flexGrow:0,flexBasis:"auto",color:this.theme.regularTextColor,minWidth:e.isSmallPhone?42:44}}}l()(he,"unindentIcon",m.a.indentDown({width:18,height:18,transform:"rotate(90deg)",position:"relative",left:1})),l()(he,"indentIcon",m.a.indentDown({width:18,height:18,transform:"rotate(-90deg)",position:"relative",left:-1})),l()(he,"moveUpIcon",m.a.moveUp({width:18,height:18,position:"relative",left:2})),l()(he,"moveDownIcon",m.a.moveUp({width:18,height:18,transform:"rotate(180deg)",position:"relative",left:2})),l()(he,"undoIcon",m.a.undo({width:19,height:19})),l()(he,"redoIcon",m.a.redo({width:19,height:19})),l()(he,"trashIcon",m.a.trash({width:18,height:18})),l()(he,"discussionIcon",m.a.speechBubbleThin({width:18,height:18})),l()(he,"plusIcon",m.a.thinPlus({width:14,height:14})),l()(he,"keyboardIcon",m.a.keyboard({width:18,height:18})),l()(he,"imageIcon",m.a.image({width:18,height:18})),l()(he,"height",42),l()(he,"minorItemStyle",{width:34,justifyContent:"center"}),t.default=Object(H.injectIntl)(he)},fJfa:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("lSNA"),a=o.n(s),r=(o("3bBZ"),o("Zo/l")),l=o("q1tI"),d=o.n(l);function c(e,t){const o=Object(l.useRef)(Math.random().toString(36).substr(2,9)),n=t;return Object(l.useEffect)(()=>{const t=o.current;if(e)return e({type:"mount",id:t,props:n}),()=>e({type:"unmount",id:t})},[e,n]),e?o.current:void 0}var h=o("wldR"),u=o("J9+s"),m=o("sFjn"),p=o("LEzx");class g extends p.a{getInitialState(){return{schemaOverride:null}}}var b=g,S=o("mINO"),f=o("pFdg");function v(e,t,o){const{content:n,apiRequestValue:i}=o;return{id:e,content:n,action:{type:t,apiRequestValue:i}}}const y=Object.keys({bold:!0,italic:!0,underline:!0,strikethrough:!0,link:!0,code:!0,equation:!0,mention:!0,trash:!0,comment:!0,filePicker:!0,indent:!0,unindent:!0,moveUp:!0,moveDown:!0,undo:!0,redo:!0,dismissKeyboard:!0}),k=Object.keys({textColor:!0,insertBlock:!0,turnInto:!0,more:!0});function C(e,t){const o={type:e,data:t};return JSON.stringify(o)}const w={showActionBarMenu:S.j({required:{type:S.f("showActionBarMenu"),data:S.j({required:{actionBarMenuId:S.g(...k)},optional:{}})},optional:{}}),blockAction:S.j({required:{type:S.g("blockAction"),data:S.j({required:{action:S.g(...y)},optional:{}})},optional:{}}),setTextColor:S.j({required:{type:S.f("setTextColor"),data:S.j({required:{textColor:S.l()},optional:{}})},optional:{}}),setTextBackgroundColor:S.j({required:{type:S.f("setTextBackgroundColor"),data:S.j({required:{textBackgroundColor:S.l()},optional:{}})},optional:{}})},T=Object.keys(w);let B;!function(e){e[e.InvalidActionType=0]="InvalidActionType",e[e.MissingPayload=1]="MissingPayload",e[e.InvalidRequestType=2]="InvalidRequestType",e[e.InvalidData=3]="InvalidData"}(B||(B={}));class P{constructor(e,t){this.type=e,this.message=t}}const I={id:"mab.buttonSection.back",buttons:[v("mab.button.back","nativeAction_setSubMenuButtons",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.backward.2",sfProGlyphCodePoints:"DBC3-DC2A",localImageIdentifier:"back"}},apiRequestValue:{subMenuButtonSections:null}})]};function M(e){const{disableTextActions:t}=e;return{id:"mab.buttonSection.textFormatting",buttons:[v("mab.button.bold","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bold",sfProGlyphCodePoints:"DBC0-DD53",localImageIdentifier:"bold"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"bold"})}}),v("mab.button.italic","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"italic",sfProGlyphCodePoints:"DBC0-DD54",localImageIdentifier:"italic"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"italic"})}}),v("mab.button.underline","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"underline",sfProGlyphCodePoints:"DBC0-DD55",localImageIdentifier:"underline"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"underline"})}}),v("mab.button.strikethrough","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"strikethrough",sfProGlyphCodePoints:"DBC0-DD56",localImageIdentifier:"strikethrough"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"strikethrough"})}}),v("mab.button.textColor","webAction_generic",{content:{type:"icon",imageReference:{localImageIdentifier:"textColor"},disabled:t},apiRequestValue:{jsonPayload:C("showActionBarMenu",{actionBarMenuId:"textColor"})}}),v("mab.button.textColor.native","nativeAction_showActionBarMenu",{content:{type:"icon",imageReference:{localImageIdentifier:"textColor"},disabled:t},apiRequestValue:{actionBarMenuId:"textColor"}}),v("mab.button.code","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.left.slash.chevron.right",sfProGlyphCodePoints:"DBC1-DE5A",localImageIdentifier:"code"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"code"})}}),v("mab.button.link","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"link",sfProGlyphCodePoints:"DBC0-DE63",localImageIdentifier:"link"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"link"})}}),v("mab.button.equation","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"x.squareroot",sfProGlyphCodePoints:"DBC1-DCEA",localImageIdentifier:"equation"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"equation"})}})]}}var A=o("zmp8");const x=Object(u.defineMessages)({nativeMenuTextColor:{id:"mobileActionBar.nativeMenu.textColor.title",defaultMessage:"Color"}});function R(e){const t=e.blockColors,o=Object.keys(t).filter(e=>-1===e.indexOf("background")).map(e=>{const o=e;return{color:o,hexColor:Object(A.n)(t[o].color)}});return{id:"textColor",sections:[{id:"nativeMenu.section.textColor",title:x.nativeMenuTextColor,items:o.map(e=>{const t="default"!==e.color?e.hexColor:void 0;return{id:"nativeMenu.section.textColor.".concat(e.color),title:Object(A.j)(e.color),icon:{sfProGlyphName:"character",sfProGlyphCodePoints:"DBC0-DD4F",imageTintColor:t},action:(o="webAction_generic",n={jsonPayload:C("setTextColor",{textColor:e.color})},{type:o,apiRequestValue:n}),checked:!1};var o,n})}]}}function O(e){const{disableBlockActions:t,disableTextActions:o,disableCommentAction:n,disableMentionAction:i}=e;return{id:"mab.buttonSection.0",buttons:[v("mab.button.insert","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"plus",sfProGlyphCodePoints:"DBC0-DD7C",localImageIdentifier:"insertBlock"},disabled:t},apiRequestValue:{jsonPayload:C("showActionBarMenu",{actionBarMenuId:"insertBlock"})}}),v("mab.button.turnInto","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",sfProGlyphCodePoints:"DBC0-DD4C",localImageIdentifier:"turnInto"},disabled:t},apiRequestValue:{jsonPayload:C("showActionBarMenu",{actionBarMenuId:"turnInto"})}}),v("mab.button.filePicker","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"photo.on.rectangle.angled",sfProGlyphCodePoints:"DBC2-DCF5",localImageIdentifier:"filePicker"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"filePicker"})}}),v("mab.button.mention","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"at",sfProGlyphCodePoints:"DBC0-DD77",localImageIdentifier:"mention"},disabled:i},apiRequestValue:{jsonPayload:C("blockAction",{action:"mention"})}}),v("mab.button.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",sfProGlyphCodePoints:"DBC0-DF2A",localImageIdentifier:"comment"},disabled:n},apiRequestValue:{jsonPayload:C("blockAction",{action:"comment"})}}),v("bold.italic.underline","nativeAction_setSubMenuButtons",{content:{type:"icon",imageReference:{sfProGlyphName:"bold.italic.underline",sfProGlyphCodePoints:"DBC0-DD57",localImageIdentifier:"boldItalicUnderline"}},apiRequestValue:{subMenuButtonSections:[I,M({disableTextActions:o})]}})]}}function D(e){const{disableBlockActions:t,disableIndent:o,disableUnindent:n}=e;return{id:"mab.buttonSection.1",buttons:[v("mab.button.indent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"decrease.indent",sfProGlyphCodePoints:"DBC0-DEF6",localImageIdentifier:"unindent"},disabled:t||n},apiRequestValue:{jsonPayload:C("blockAction",{action:"unindent"})}}),v("mab.button.unindent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"increase.indent",sfProGlyphCodePoints:"DBC0-DEF5",localImageIdentifier:"indent"},disabled:t||o},apiRequestValue:{jsonPayload:C("blockAction",{action:"indent"})}}),v("mab.button.moveUp","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.up.to.line.alt",sfProGlyphCodePoints:"DBC0-DD43",localImageIdentifier:"moveUp"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"moveUp"})}}),v("mab.button.moveDown","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.down.to.line.alt",sfProGlyphCodePoints:"DBC0-DD44",localImageIdentifier:"moveDown"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"moveDown"})}})]}}function F(e){const{disableUndo:t,disableRedo:o}=e;return{id:"mab.buttonSection.3",buttons:[v("mab.button.undo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.counterclockwise",sfProGlyphCodePoints:"DBC0-DD49",localImageIdentifier:"undo"},disabled:t},apiRequestValue:{jsonPayload:C("blockAction",{action:"undo"})}}),v("mab.button.redo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.clockwise",sfProGlyphCodePoints:"DBC0-DD48",localImageIdentifier:"redo"},disabled:o},apiRequestValue:{jsonPayload:C("blockAction",{action:"redo"})}}),v("mab.button.delete","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"trash",sfProGlyphCodePoints:"DBC0-DE11",localImageIdentifier:"trash"}},apiRequestValue:{jsonPayload:C("blockAction",{action:"trash"})}}),v("mab.button.more","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"ellipsis",sfProGlyphCodePoints:"DBC0-DF60",localImageIdentifier:"more"}},apiRequestValue:{jsonPayload:C("showActionBarMenu",{actionBarMenuId:"more"})}})]}}function j(e){return{actionApi:{nativeAction_showActionBarMenu:{request:{actionBarMenuId:""},response:{}},nativeAction_setSubMenuButtons:{request:{subMenuButtonSections:[]},response:{}},nativeAction_hideKeyboard:{request:{},response:{}},webAction_generic:{request:{jsonPayload:"{}"},response:{}}},nativeMenus:{textColor:R(Object(A.q)("light"))},state:{buttonSections:e,dismissKeyboardButton:v("mab.dismissKeyboard","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"keyboard.chevron.compact.down",sfProGlyphCodePoints:"DBC1-DCD6",localImageIdentifier:"keyboardDown"}},apiRequestValue:{jsonPayload:C("blockAction",{action:"dismissKeyboard"})}}),mutatedNativeMenus:{},localizedMessages:{}}}}var L=o("6nbh"),N=o("3Z0Q"),V=o("EszA"),q=o("y6Dp"),E=o("oaNT"),U=o("sjR4"),W=o("gRnv"),G=o("6rsX"),_=o("unoy"),z=o("BTUg"),Q=o("MBf9"),Z=o("5w/s"),H=o("VpIZ"),X=o("CaJT"),J=o("l4I2");function K(e){var t;const{onAction:o,fallbackRenderer:n,...i}=e,s=c(null===(t=Object(r.b)().reactNative)||void 0===t?void 0:t.api.renderMobileActionBar,i);return function(e,t,o,n){var i;const s=null===(i=Object(r.b)().reactNative)||void 0===i?void 0:i.componentEvents;Object(l.useEffect)(()=>{if(s&&n&&t)return s.addListener(e,t,o,n)},[e,t,o,n,s])}("MobileActionBar",s,"onAction",o),!s&&n?d.a.createElement(d.a.Fragment,null,n()):null}class Y extends h.a{constructor(...e){super(...e),a()(this,"storeTypes",{store:m.a,nativeStore:b,ignoreSelectionAreaStore:L.a}),a()(this,"getCurrentActionBarSchema",this.createComputedStore(()=>{const e=this.shouldShowTextActions.state;e&&this.stores.nativeStore.setState({schemaOverride:null});const t=this.stores.nativeStore.state.schemaOverride;if(t)return t;const o=this.shouldShowBlockActions.state;var n=[];if(e){n=[M({disableTextActions:!this.canTriggerTextActions.state})]}else if(o){const e=!this.canTriggerTextActions.state,t=!this.canTriggerBlockActions.state,o=this.props.currentBlockStore.getValue(),i=this.commentActionDisabled(o),s=this.mentionActionDisabled(o),a=U.default.state.stores[0],r=!J.a(a),l=!J.b(a),d=!X.b(),c=!X.a();n=[O({disableBlockActions:t,disableTextActions:e,disableCommentAction:i,disableMentionAction:s}),D({disableBlockActions:t,disableIndent:r,disableUnindent:l}),F({disableUndo:d,disableRedo:c})]}return j(n)})),a()(this,"shouldShow",this.createComputedStore(()=>N.c(this.environment,this.stores.ignoreSelectionAreaStore))),a()(this,"shouldShowTextActions",this.createComputedStore(()=>N.e(this.stores.ignoreSelectionAreaStore))),a()(this,"shouldShowBlockActions",this.createComputedStore(()=>!this.shouldShowTextActions.state)),a()(this,"canTriggerBlockActions",this.createComputedStore(()=>N.a(this.shouldShowBlockActions.state,this.pageContext&&this.pageContext.publicEditModeStore.state))),a()(this,"canTriggerTextActions",this.createComputedStore(()=>N.b(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore)))}renderComponent(){return i()(K,{isOpen:this.isOpen(),schema:this.getCurrentActionBarSchema.state,onAction:e=>{const{action:t}=e;switch(t.type){case"nativeAction_showActionBarMenu":case"nativeAction_hideKeyboard":break;case"nativeAction_setSubMenuButtons":const e=t.apiRequestValue;null===e.subMenuButtonSections?this.stores.nativeStore.setState({schemaOverride:null}):this.stores.nativeStore.setState({schemaOverride:j(e.subMenuButtonSections)});break;case"webAction_generic":this.handleGenericWebAction(t)}},fallbackRenderer:this.props.fallbackRenderer})}commentActionDisabled(e){return!(!e||!Object(H.B)(e))}mentionActionDisabled(e){return!(!e||!Object(H.C)(e))}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.shouldShow.state}handleGenericWebAction(e){const t=function(e){if("webAction_generic"!==e.type)return new P(B.InvalidActionType,void 0);const t=e.apiRequestValue;if(!(t&&"jsonPayload"in t))return new P(B.MissingPayload,void 0);const o=JSON.parse(t.jsonPayload),n=S.j({required:{type:S.g(...T)},optional:{}}),i=Object(f.d)(n,o);if(i)return new P(B.InvalidRequestType,JSON.stringify(i));const s=o,a=w[s.type],r=Object(f.d)(a,s);return r?new P(B.InvalidData,JSON.stringify(r)):s}(e);if(t instanceof P)console.error(JSON.stringify(t));else switch(t.type){case"blockAction":switch(t.data.action){case"bold":this.handleTextAnnotation(["b"]);break;case"code":this.handleTextAnnotation(["c"]);break;case"comment":this.handleComment();break;case"equation":break;case"filePicker":E.a(this.environment),this.trackItemTap("take_picture");break;case"indent":break;case"italic":this.handleTextAnnotation(["i"]);break;case"link":case"mention":case"moveDown":case"moveUp":case"redo":break;case"strikethrough":this.handleTextAnnotation(["s"]);break;case"trash":break;case"underline":this.handleTextAnnotation(["_"]);break;case"undo":case"unindent":break;case"dismissKeyboard":this.handleDismissKeyboard()}break;case"setTextColor":this.handleSetTextColor(t.data.textColor)}}handleTextAnnotation(e){V.a({environment:this.environment,annotation:e}),q.oe(this.environment,{action:e[0]})}handleComment(){const e=U.default.state.stores[0];e&&(W.d({environment:this.environment,blockStore:e}),this.trackItemTap("discuss"))}handleDismissKeyboard(){G.e(this.environment),this.trackItemTap("hide_keyboard"),_.e()}handleSetTextColor(e){if(Object(f.d)(S.g(...A.c),e))return;const t=e;"default"!==t&&z.a.setHighlightColor(t),Q.createAndCommit(this.environment,e=>{Z.h({stores:U.default.state.stores,update:{block_color:"default"===t?void 0:t},transaction:e})})}trackItemTap(e){q.Me(this.environment,{itemName:e})}}t.default=Object(u.injectIntl)(Y)},oaNT:function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));var n=o("q2qQ"),i=o("p+Y9"),s=o("MBf9"),a=o("dsG5"),r=o("6rsX"),l=o("HTHG"),d=o("sjR4");async function c(e){const t=await i.b({multiple:!0,accept:e.device.isIOS?"image/*, video/*":"image/*"}),o=d.default.getCurrentRecordCache(),c=l.b(e);0!==t.length&&o&&s.createAndCommit(e,i=>{const s=a.a({environment:e,files:t,inMemoryRecordCache:o,pageWidth:c,transaction:i});n.k({environment:e,blocks:s,selection:d.default.state.stores,transaction:i,replaceEmptyTextBlock:!0}),r.e(e)})}},sFjn:function(e,t,o){"use strict";var n=o("LEzx");class i extends n.a{getInitialState(){return{isOpen:!1,isInsertOpen:!1,isTurnIntoOpen:!1,isColorOpen:!1,isTemplatesOpen:!1}}}t.a=i},tCjx:function(e,t,o){"use strict";o.r(t);var n=o("gcR/"),i=o.n(n),s=o("lSNA"),a=o.n(s),r=(o("3bBZ"),o("q1tI")),l=o("wldR"),d=o("MeYt"),c=o("FcJC"),h=o("mF3+"),u=o("QcDD"),m=o("ikHm"),p=o("4aFz"),g=o("id5p"),b=o("y6Dp"),S=o("CaJT"),f=o("HTFi");class v extends l.a{constructor(...e){super(...e),a()(this,"handleClickFind",()=>{p.c({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),b.Ne(this.environment,{itemName:"search"})}),a()(this,"handleClickQuickAdd",()=>{c.quickAddPage({environment:this.environment,from:"mobile_bottom_bar"}),b.Ne(this.environment,{itemName:"add_page"})}),a()(this,"handleUndo",()=>{S.f(this.environment,!0),b.Ne(this.environment,{itemName:"undo"})}),a()(this,"handleRedo",()=>{S.e(this.environment,!0),b.Ne(this.environment,{itemName:"redo"})}),a()(this,"canQuickAdd",this.createComputedStore(()=>Boolean(u.default.state.currentSpaceStore&&u.default.state.currentSpaceStore.canEdit())))}renderComponent(){const e=f.a.state;if(e){const{isTablet:t}=this.environment.device;return i()("div",{style:this.getWrapStyle(e)},void 0,t?this.renderTabletButtons():this.renderPhoneButtons())}}renderPhoneButtons(){return i()(r.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton())}renderTabletButtons(){return i()(r.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton(),this.renderUndoRedoButtons())}renderSearchButton(){return i()(d.a,{style:this.getSearchButtonStyle(),onClick:this.handleClickFind,mobileFeedback:!0},void 0,h.a.mobileBottomBarSearch(this.getIconStyle()))}renderUpdatesButton(){const{isTablet:e}=this.environment.device;return i()(g.a,{format:e?g.a.Format.MobileBottomBarTablet:g.a.Format.MobileBottomBarPhone})}renderQuickAddPageButton(){return i()(d.a,{style:this.getQuickAddButtonStyle(),onClick:this.handleClickQuickAdd,mobileFeedback:!0,disabled:!this.canQuickAdd.state,disabledFeedback:!0},void 0,h.a.mobileBottomBarAddPage(this.getIconStyle()))}renderUndoRedoButtons(){return i()(r.Fragment,{},void 0,i()(d.a,{style:this.getUndoButtonStyle(),onClick:this.handleUndo,mobileFeedback:!0,disabled:!S.b(),disabledFeedback:!0},void 0,h.a.mobileBottomBarUndo(this.getIconStyle())),i()(d.a,{style:this.getRedoButtonStyle(),onClick:this.handleRedo,mobileFeedback:!0,disabled:!S.a(),disabledFeedback:!0},void 0,h.a.mobileBottomBarRedo(this.getIconStyle())))}getWrapStyle(e){const{WindowSizeStore:t}=this.environment,{isTablet:o}=this.environment.device;return{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:o?"flex-start":"space-around",height:t.getSafePaddingBottomCSS(v.height),paddingBottom:t.state.paddingBottomCSS,background:this.theme.contentBackground,borderTop:"1px ".concat(this.theme.darkDividerColor," solid"),zIndex:m.k,opacity:e?1:0,pointerEvents:e?"auto":"none",cursor:"pointer"}}getSearchButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:1,paddingLeft:e.getSafePaddingLeftCSS(18),...t&&{flex:"none",paddingLeft:2,width:v.tabletButtonWidth,justifyContent:"center"}}}getQuickAddButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-end",flex:1,paddingRight:e.getSafePaddingRightCSS(18),...t&&{justifyContent:"center",flex:"none",paddingRight:0,width:v.tabletButtonWidth,marginRight:"auto"}}}getUndoButtonStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:"none",paddingLeft:e.getSafePaddingLeftCSS(18),width:v.tabletButtonWidth}}getRedoButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",width:v.tabletButtonWidth,paddingRight:4}}getIconStyle(){return{width:26,fill:this.theme.regularTextColor}}}a()(v,"height",44),a()(v,"tabletButtonWidth",54),t.default=v}}]);